function urlB64ToUint8Array(n){const r="=".repeat((4-n.length%4)%4),u=(n+r).replace(/\-/g,"+").replace(/_/g,"/"),t=window.atob(u),i=new Uint8Array(t.length);for(let n=0;n<t.length;++n)i[n]=t.charCodeAt(n);return i}const MODALFORM="ModalForm",SESSIONTIMEOUT="SessionTimeout",ORDEREVENTS="OrderEvents",MODALPRIORITY="ModalPriority",PRINTTICKET="PrintTicket",SMARTSEARCH="SmartSearch";(function(n){"use strict";var r=window.navigator.standalone,i=window.navigator.userAgent.toLowerCase(),u=/safari/.test(i),f=/ios|iphone|ipad|ipod|ipados/.test(i),e=/android [0-9].[0-9].[0-9];.*mobile;.*firefox|safari|chrome/.test(i),t;n.sessionTimeout=function(){this.init()};n.modalForm=function(n){this.init(n)};n.orderEvents=function(n){this.init(n)};n.modalPriority=function(n,t){this.init(n,t)};n.printTicket=function(n,t){this.init(n,t)};n.smartSearch=function(n,t){this.init(n,t)};n.sendPrintToApple=function(n){window.webkit.messageHandlers.openPDF.postMessage(n)};n.showNotification=function(n,t){Notification.permission=="granted"&&navigator.serviceWorker.getRegistration().then(function(i){var r={body:t,icon:"/images/logo.png",badge:"/images/logo.png",vibrate:[100,50,100],actions:[{action:"show",title:"Mostrar",icon:"/images/check.png"},{action:"close",title:"Cerrar",icon:"/images/cancel.png"},]};i.showNotification(n,r)})};n.extend(n.sessionTimeout,{prototype:{settings:{modalId:"#timeoutModal",time:6e4,login:"/Account/Login",url:"/Account/CheckSession"},init:function(){this.modal=n(this.settings.modalId);this.modal.modalPriority({index:3001});this.bind()},bind:function(){this.modal.on("hide.bs.modal",this.hide);setTimeout(this.check,this.settings.time,this)},hide:function(){window.location.reload()},check:function(t){t=t===undefined?this:t;window.location.pathname!==t.settings.login&&n.ajax({method:"GET",url:t.settings.url,success:function(){setTimeout(t.check,t.settings.time,t)},error:function(n){n.status==401&&t.show(t)}})},show:function(n){n=n===undefined?this:n;n.modal.modal("show")}}});n.extend(n.modalForm,{prototype:{settings:{succesElement:".alert-success",successTemplate:'<i class="fa fa-check-circle fa-fw"><\/i> Aceptar',successClass:"btn btn-success",waitModalId:"#waitModal"},init:function(t){this.element=n(t);this.title=this.element.find(".modal-title");this.body=this.element.find(".modal-body");this.footer=this.element.find(".modal-footer");this.form=undefined;this.submitButton=this.footer.find("button[type=submit]");this.cancelButton=this.footer.find("button[type=button]");this.waitModal=n(this.settings.waitModalId);this.bind()},bind:function(){this.element.on("show.bs.modal",this,this.show);this.element.on("hide.bs.modal",this,this.hide);this.submitButton.on("click",this,this.submit);this.waitModal.modalPriority()},hide:function(){window.location.reload()},show:function(t){var i=t.data,r=n(t.relatedTarget),f=r.data("title"),u=r.data("id"),e=u!=undefined?r.data("url")+"/"+u:r.data("url");i.title.html(f);n.ajax({method:"GET",url:e,success:function(t){i.body.html(t);i.form=i.body.find("form");n.validator.unobtrusive.parse(i.form);i.form.find("[data-mask=true]").inputmask({autoUnmask:!0});i.form.orderEvents();i.body.find('[data-smart="true"]').smartSearch();i.footer.find('[data-print="true"]').printTicket()},error:function(t){t.status==401&&n("body").sessionTimeout("show")}})},submit:function(t){var i=t.data,r=i.form,u=r.attr("method"),f=r.attr("action");r.valid()&&(i.submitButton.addClass("disabled").attr("disabled",!0),i.waitModal.modal("show"),n.ajax({method:u,url:f,data:r.serialize(),success:function(n){i.body.html(n);i.body.find(i.settings.succesElement).length>0?(i.submitButton.remove(),i.cancelButton.removeAttr("class").addClass(i.settings.successClass).html(i.settings.successTemplate)):i.submitButton.removeClass("disabled").removeAttr("disabled");i.waitModal.modal("hide")},error:function(t){t.status==401&&n("body").sessionTimeout("show")}}))}}});n.extend(n.orderEvents,{prototype:{settings:{productUrl:"/Product/Products",priceUrl:"/Product/Price/",rowTemplate:'<div class="card my-3" data-index="{idx}"><div class="card-header d-flex justify-content-between p-1"><h5 class="m-2">Art&iacute;culo #{pdx}<\/h5><button type="button" class="btn btn-danger" data-action="remove"><i class="fa fa-trash-alt"><\/i><\/button><\/div><div class="card-body p-1"><input type="hidden" id="OrderDetails{idx}_OrderDetailId" name="OrderDetails[{idx}].OrderDetailId" value="0" /><div class="form-row my-2"><label for="OrderDetails{idx}_OrderDetailQuantity" class="col-form-label col-3 text-right">Cantidad<\/label><div class="col-9"><input type="text" inputmode="decimal" id="OrderDetails{idx}_OrderDetailQuantity" name="OrderDetails[{idx}].OrderDetailQuantity" class="form-control text-right" value="1" data-val="true" data-val-required="La cantidad para el artículo #{pdx} es requerida." /><\/div><\/div><div class="form-row my-2"><label for="OrderDetails{idx}_ProductId" class="col-form-label col-3 text-right">Producto<\/label><div class="col-9"><select id="OrderDetails{idx}_ProductId" name="OrderDetails[{idx}].ProductId" class="form-control" data-val="true" data-val-required="Seleccione un producto en el artículo #{pdx}"><\/select><\/div><\/div><div class="form-row my-2"><label for="OrderDetails{idx}_OrderDetailPrice" class="col-form-label col-3 text-right">Precio<\/label><div class="col-9"><input type="text" inputmode="decimal" id="OrderDetails{idx}_OrderDetailPrice" name="OrderDetails[{idx}].OrderDetailPrice" class="form-control" value="0" data-val="false" data-mask="true" data-inputmask="\'alias\': \'decimal\', \'groupSeparator\': \',\', \'autoGroup\': true, \'digits\': 2, \'digitsOptional\': false, \'placeholder\': \'0\'" /><\/div><\/div><div class="form-row my-2"><label for="OrderDetails{idx}_OrderDetailTotal" class="col-form-label col-3 text-right">Total<\/label><div class="col-9"><input type="text" inputmode="decimal" id="OrderDetails{idx}_OrderDetailTotal" name="OrderDetails[{idx}].OrderDetailTotal" class="form-control" value="0" data-val="false" data-mask="true" data-inputmask="\'alias\': \'decimal\', \'groupSeparator\': \',\', \'autoGroup\': true, \'digits\': 2, \'digitsOptional\': false, \'placeholder\': \'0\'" /><\/div><\/div><\/div><\/div>'},init:function(t){this.element=n(t);this.element.data("action")==="order"&&(this.addButton=this.element.find('[data-action="add"]'),this.removeButton=this.element.find('[data-action="remove"]'),this.deliveryTax=this.element.find('input[id*="OrderDeliveryTax"]'),this.products=[],this.index=0,this.bind(),this.fetch())},bind:function(){this.addButton.on("click",this,this.addRow);this.removeButton.on("click",this,this.removeRow);this.deliveryTax.on("change blur",this,this.doTotal)},fetch:function(){var t=this;n.ajax({method:"GET",url:this.settings.productUrl,success:function(n){t.products=n;t.index=t.element.find("[data-index]").length-1;t.index>0?t.bindRows(t):(t.fill(t),t.bindRow(t))},error:function(t){t.status==401&&n("body").sessionTimeout("show")}})},fill:function(t){var i=t.element.find("#OrderDetails"+t.index+"_ProductId");i.append('<option value="">--- Seleccione uno ---<\/option>');n.each(t.products,function(n,t){i.append('<option value="'+t.Key+'">'+t.Value+"<\/option>")})},addRow:function(n){var t=n.data,i;t.index++;i=t.settings.rowTemplate.replace(/{idx}/g,t.index).replace(/{pdx}/g,t.index+1);t.element.find("[data-articles]").append(i).find("[data-mask=true]").inputmask({autoUnmask:!0});t.fill(t);t.bindRow(t);t.addValidation(t)},addValidation:function(t){var i=t.data!=undefined?t.data:t;n(i.element).removeData("validator");n(i.element).removeData("unobtrusiveValidation");n.validator.unobtrusive.parse(i.element)},bindRows:function(n){n.element.find("input[id*=_OrderDetailQuantity]").on("change blur",n,n.doCalculate);n.element.find("input[id*=_OrderDetailPrice]").on("change blur",n,n.doCalculate);n.element.find("input[id*=_OrderDetailTotal]").on("change blur",n,n.getQuantity);n.element.find("select[id*=_ProductId]").on("change",n,n.getPrice);n.element.find('[data-action="remove"]').on("click",n,n.removeRow)},bindRow:function(n){n.element.find("#OrderDetails"+n.index+"_OrderDetailQuantity").on("change blur",n,n.doCalculate);n.element.find("#OrderDetails"+n.index+"_OrderDetailPrice").on("change blur",n,n.doCalculate);n.element.find("#OrderDetails"+n.index+"_OrderDetailTotal").on("change blur",n,n.getQuantity);n.element.find("#OrderDetails"+n.index+"_ProductId").on("change",n,n.getPrice);n.element.find('[data-action="remove"]').on("click",n,n.removeRow)},removeRow:function(t){var i=t.data;n(this).parent().parent().remove();i.doTotal(i)},getPrice:function(t){var i=t.data,r=n(this).val(),u=n(this).closest(".card").data("index");n.ajax({method:"GET",url:i.settings.priceUrl+r,success:function(n){i.element.find("#OrderDetails"+u+"_OrderDetailPrice").val(n);i.doCalculate(t)},error:function(t){t.status==401&&n("body").sessionTimeout("show")}})},doCalculate:function(t){var i=t.data,r=n(t.currentTarget).closest(".card").data("index"),u=i.element.find("#OrderDetails"+r+"_OrderDetailQuantity"),f=i.element.find("#OrderDetails"+r+"_OrderDetailPrice"),e=i.element.find("#OrderDetails"+r+"_OrderDetailTotal"),o=parseFloat(u.val()),s=parseFloat(f.val()),h=o*s;e.val(h);i.doTotal(i)},doTotal:function(t){t=t.data!=undefined?t.data:t;var i=0,r=0,u=0;t.element.find("input[id*=OrderDetailTotal]").each(function(){i+=parseFloat(n(this).inputmask("unmaskedvalue"))});i+=parseFloat(n("#OrderDeliveryTax").inputmask("unmaskedvalue"));r=i*.16;u=i-r;n("#OrderTax").val(r);n("#OrderSubtotal").val(u);n("#OrderTotal").val(i);n("#TextTotal").text("$"+i.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,"$&,"))},getQuantity:function(t){var i=t.data,r=n(t.currentTarget).closest(".card").data("index"),u=i.element.find("#OrderDetails"+r+"_OrderDetailQuantity"),f=i.element.find("#OrderDetails"+r+"_OrderDetailPrice"),e=i.element.find("#OrderDetails"+r+"_OrderDetailTotal"),o=parseFloat(e.val()),s=parseFloat(f.val()),h=o/s;u.val(h.toFixed(2));i.doTotal(i)}}});n.extend(n.modalPriority,{prototype:{settings:{index:2001},init:function(t,i){this.element=n(t);this.config=n.extend({},this.settings,i);this.bind()},bind:function(){this.element.on("shown.bs.modal",this,this.style)},style:function(t){var i=t.data;n(t.currentTarget).css("z-index",i.config.index);n(".modal-backdrop").last().css("z-index",i.config.index-1)}}});n.extend(n.printTicket,{prototype:{settings:{target:"#detailsModal .modal-body",id:"#OrderId",wait:"#waitModal"},init:function(t,i){this.element=n(t);this.config=n.extend({},this.settings,i);this.orderId=n(this.config.id).val();this.orderId==0||this.orderId==undefined?this.hide():this.bind()},bind:function(){this.element.on("click",this,this.receipt)},receipt:function(n){var t=n.data;n.preventDefault();n.stopPropagation();f?t.iosShare(n):t.download(n)},hide:function(){this.element.remove()},iosShare:function(t){var i=t.data!=undefined?t.data:t,r="/print/printappleorder/"+i.orderId;n(i.config.wait).modal("show");n.sendPrintToApple(r)},download:function(n){var i=n.data!=undefined?n.data:n,t=document.createElement("a");t.href="/print/printorder/"+i.orderId;t.download=i.orderId+".pdf";t.click()}}});n.extend(n.smartSearch,{prototype:{settings:{url:"/Customer/SearchCustomer",count:10,template:'<div class="smart-results py-2 px-0"><ul class="list-unstyled mb-0"><\/ul><\/div>',resultTemplate:'<li data-id="{id}" class="py-3 px-2 pointer"><i class="fa fa-user-tie fa-fw"><\/i>&nbsp;<span aria-label="name">{name}<\/span><\/li>',storage:"#CustomerId"},init:function(t,i){this.element=n(t);this.config=n.extend({},this.settings,i);n("body").append(this.config.template);this.wrapper=n(".smart-results");this.list=this.wrapper.find("ul");this.collapseSection=this.element.data("target");this.bind()},bind:function(){this.element.on("focus",this,this.clear);this.element.on("keyup.smartSearch",this,this.search);this.wrapper.on("mouseenter touchstart",this,this.in);this.wrapper.on("mouseleave touchend",this,this.out);n(document).on("click",this,this.hide)},clear:function(t){var i=t.data!=undefined?t.data:t;n(this).val("").removeClass("is-valid").removeClass("is-invalid");n(i.storage).val("");i.hideSection(t)},search:function(t){var i=t.data!=undefined?t.data:t,r=n(this).val().trim();r.length>=2?i.post(t,r):i.hide(t)},post:function(t,i){var r=t.data!=undefined?t.data:t,u=JSON.parse(JSON.stringify({search:i,count:this.config.count}));n.ajax({method:"POST",url:r.config.url,data:u,success:function(i){r.list.html("");n.each(i,function(n,t){var i=r.config.resultTemplate.replace(/{id}/g,t.Key).replace(/{name}/g,t.Value);r.list.append(i);r.list.find("li").last().on("click",r,r.select)});r.show(t)},error:function(n){console.log(n.statusText)}})},show:function(n){var t=n.data!=undefined?n.data:n;t.wrapper.css({top:t.element.offset().top+38,left:t.element.offset().left,width:t.element.css("width")});t.wrapper.slideDown("slow")},hide:function(n){var t=n.data!=undefined?n.data:n;t.isVisible||(t.wrapper.slideUp("slow"),t.list.html(""))},"in":function(n){var t=n.data!=undefined?n.data:n;t.isVisible=!0},out:function(n){var t=n.data!=undefined?n.data:n;t.isVisible=!1},select:function(t){var i=t.data!=undefined?t.data:t,r=n(this).data("id"),u=n(this).find('[aria-label="name"]').text();r==0?i.showSection(t):i.hideSection(t);i.element.val(u);n(i.config.storage).val(r);i.isVisible=!1;i.hide(t)},showSection:function(t){var i=t.data!=undefined?t.data:t;n(i.collapseSection).slideDown("slow")},hideSection:function(t){var i=t.data!=undefined?t.data:t;n(i.collapseSection).slideUp("slow")}}});n.extend(n.fn,{modalForm:function(){return this.each(function(){var t=n(this).data(MODALFORM);return t||(t=new n.modalForm(this),n(this).data(MODALFORM,t)),t})},sessionTimeout:function(t){var i=arguments;return this.each(function(){var r=n(this).data(SESSIONTIMEOUT);return r||(r=new n.sessionTimeout,n(this).data(SESSIONTIMEOUT,r)),typeof t=="string"&&(i.length>1?r[t].apply(r,Array.prototype.slice.call(i,1)):r[t]()),r})},orderEvents:function(){return this.each(function(){var t=n(this).data(ORDEREVENTS);return t||(t=new n.orderEvents(this),n(this).data(ORDEREVENTS,t)),t})},modalPriority:function(t){return this.each(function(){var i=n(this).data(MODALPRIORITY);return i||(i=new n.modalPriority(this,t),n(this).data(MODALPRIORITY,i)),i})},printTicket:function(t){return this.each(function(){var i=n(this).data(PRINTTICKET);return i||(i=new n.printTicket(this,t),n(this).data(PRINTTICKET,i)),i})},smartSearch:function(t){return this.each(function(){var i=n(this).data(SMARTSEARCH);return i||(i=new n.smartSearch(this,t),n(this).data(SMARTSEARCH,i)),i})}});n("body").sessionTimeout();n(".modal-form").modalForm();n(".sb-sidenav a.nav-link").each(function(t,i){n(i).attr("href")===window.location.pathname&&n(i).addClass("active")});n("#sidebarToggle").on("click",function(t){t.preventDefault();n("body").toggleClass("sb-sidenav-toggled")});n(".goTop").on("click",function(){n("html, body").animate({scrollTop:0},1500,"easeOutBack")});n(window).on("scroll",function(){n(this).scrollTop()>150?n(".goTop").addClass("show"):n(".goTop").removeClass("show")});n.validator&&n.validator.unobtrusive&&(t={validClass:"is-valid",errorClass:"is-invalid",highlight:function(t,i,r){n(t).removeClass(r).addClass(i)},unhighlight:function(t,i,r){n(t).removeClass(i).addClass(r)}},n.validator.setDefaults(t),n.validator.unobtrusive.options={errorClass:t.errorClass,validClass:t.validClass,invalidHandler:function(t,i){i.numberOfInvalids()>0&&n(".modal-body").animate({scrollTop:0},500)}});(r||u)&&(!r||e)||(n(".sb-nav-fixed").addClass("body-pwa-fix"),n(".sb-topnav").addClass("pwa-fix"),n("a").not("[data-toggle=modal]").click(function(t){t.preventDefault();window.location=n(this).attr("href")}))})(jQuery);